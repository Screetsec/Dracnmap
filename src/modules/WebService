#!/usr/bin/env bash

################################################
# PSCANNING FOR WEB SERVICE
################################################

# ``````````````````````````````````````````````````````````````````````````````
# Function name: _init_cli_webservice()
#
# Description:
#   Starting the Dracnmap Webservice module.
#
# Usage:
#   _init_cli_webservice
#
# Examples:
#   _init_cli_webservice
#

function _init_cli_webservice() {

  local _FUNCTION_ID="_init_cli_webservice"
  local _STATE=0

  input_array=()

  while [ "${input_array[0]}" != "back" ] ; do

    cstate="1"

    __cli_banner="WebService"

    printf "\e[1;31m%s\e[m " "${__cli_prompt}${__cli_banner}>" && read -ra input_array

    case ${input_array[0]} in

      01|1)

        $xterm --script firewall-bypass --script-args firewall-bypass.helper="ftp", firewall-bypass.targetport=22 $_ip

        cstate=1
        ;;

      02|2)

        $xterm -sS -sU -T4 -A -v $_ip
        $xterm -p80 --script http-methods,http-trace --script-args http-methods.retest $_ip

        cstate=1
        ;;

      03|3)

        $xterm -sV --script smtp-open-relay -v $_ip

        cstate=1
        ;;

      04|4)

        $xterm -sV --script smtp-strangeport $_ip

        cstate=1
        ;;

      05|5)

        $xterm -p80 --script http-phpself-xss,http-unsafe-output-escaping $_ip

        cstate=1
        ;;

      06|6)

        $xterm -p25 â€“script smtp-enum-users $_ip

        cstate=1
        ;;

      07|7)

        $xterm -p80 --script http-slowloris --max-parallelism 300 $_ip

        cstate=1
        ;;

      08|8)

        $xterm -p80 --script http-sql-injection $_ip

        cstate=1
        ;;

      09|9)

        $xterm -Pn -p80 --script ip-geolocation-* $_ip

        cstate=1
        ;;

      10)

        $xterm -sn --script whois-ip --script-args whois.whodb=nocache $_ip

        cstate=1
        ;;

      11)

        $xterm -p80 --script http-google-email,http-email-harvest $_ip

        cstate=1
        ;;

      clear)
        menu_webservice
        cstate="0" ;;
      back)
        menu
        cstate="0" ;;
      "")
        echo -en ""
        cstate="0" ;;
      *)

        if [ "$cstate" -eq "1" ] ; then

          printf "stdout: unknown command\n"

        fi

      ;;

    esac

  done

  return $_STATE

}

# Author of changes: trimstray (contact@nslab.at, https://github.com/trimstray)
#   - removed blank spaces/tabs
#   - correcting indentation (transparent code)
#   - replaced 'test' to '[[ ]]'
#   - changed comparison operator (-eq)
#   - protection against giving an illegal value
function menu_webservice() {

  clear

  echo -e $cyan ""
  echo ""
  echo -e $red " __      __      ___.       _________                  .__              ";
  echo "/  \    /  \ ____\_ |__    /   _____/ ______________  _|__| ____  ____  ";
  echo "\   \/\/   // __ \| __ \   \_____  \_/ __ \_  __ \  \/ /  |/ ___\/ __ \ ";
  echo " \        /\  ___/| \_\ \  /        \  ___/|  | \/\   /|  \  \__\  ___/ ";
  echo "  \__/\  /  \___  >___  / /_______  /\___  >__|    \_/ |__|\___  >___  >";
  echo -e $okegreen
  echo " -----------------------------------------------------------------------"
  echo ""

  echo -e $white"     ID                    DESCRIPTION"
  echo -e $white"    ---------------------------------------------------------"
  echo -e $white"    [$okegreen"01"$white]$cyan  DETECTING WEB APPLICATION FIREWALLS  "
  echo -e $white"    [$okegreen"02"$white]$cyan  DETECTING POSSIBLE XST VULNERABILITIES "
  echo -e $white"    [$okegreen"03"$white]$cyan  DETECTING OPEN RELAYS "
  echo -e $white"    [$okegreen"04"$white]$cyan  DETECTING BACKDOOR SMTP SERVERS "
  echo -e $white"    [$okegreen"05"$white]$cyan  DETECTING CROSS SITE SCRIPTING VULNERABILITIES  "
  echo -e $white"    [$okegreen"06"$white]$cyan  ENUMERATING USERS IN AN SMTP SERVER "
  echo -e $white"    [$okegreen"07"$white]$cyan  DETECTING WEB SERVERS VULNERABLE TO SLOWLORIS DDOS  "
  echo -e $white"    [$okegreen"08"$white]$cyan  FINDING SQL INJECTION VULNERABILITIES  "
  echo -e $white"    [$okegreen"09"$white]$cyan  CHECK IP GEOLOCATION WITH NSE  "
  echo -e $white"    [$okegreen"10"$white]$cyan  GATHERING INFORMATION FROM WHOIS (NSE)  "
  echo -e $white"    [$okegreen"11"$white]$cyan  COLLECTING VALID EMAIL ADDRES  "
  echo -e $white"    [$okegreen"12"$white]$cyan  BACK  "
  echo -e " "

}
