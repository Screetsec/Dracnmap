#!/usr/bin/env bash

# ``````````````````````````````````````````````````````````````````````````````
# Function name: _init_cli_malware()
#
# Description:
#   Starting the Dracnmap Malware module.
#
# Usage:
#   _init_cli_malware
#
# Examples:
#   _init_cli_malware
#

function _init_cli_malware() {

  local _FUNCTION_ID="_init_cli_malware"
  local _STATE=0

  input_array=()

  while [ "${input_array[0]}" != "back" ] ; do

    cstate="1"

    __cli_banner="nse-malware"

    printf "\e[1;31m%s\e[m " "${__cli_prompt}${__cli_banner}>" && read -ra input_array

    case ${input_array[0]} in

      01|1)

        $xterm -sV --script=auth-spoof $_ip

        cstate=1
        ;;

      02|2)

        $xterm -sn -PN --script=dns-zeustracker $_ip

        cstate=1
        ;;

      03|3)

        $xterm -p 21 --script ftp-proftpd-backdoor $_ip

        cstate=1
        ;;

      04|4)

        $xterm -p 21 --script ftp-vsftpd-backdoor $_ip

        cstate=1
        ;;

      05|5)

        $xterm -p 80 --script http-google-malware $_ip

        cstate=1
        ;;

      06|6)

        $xterm -sV --script=http-malware-host $_ip

        cstate=1
        ;;

      07|7)

        echo -ne $okegreen "An API key acquired from the virustotal web page: " ; tput sgr0
        read _key

        echo -ne $okegreen "A SHA1, SHA256, MD5 checksum of a file to check: " ; tput sgr0
        read _sum

        $xterm --script http-virustotal --script-args=http-virustotal.apikey="$_key",http-virustotal.checksum="$_sum"

        cstate=1
        ;;

      08|8)

        $xterm -sV --script=irc-unrealircd-backdoor $_ip

        cstate=1
        ;;

      09|9)

        $xterm -sV --script=smtp-strangeport $_ip

        cstate=1
        ;;

      clear)
        menu_malware
        cstate="0" ;;
      back)
        menu_nse
        cstate="0" ;;
      main)
        menu
        cstate="0" ;;
      "")
        echo -en ""
        cstate="0" ;;
      *)

        if [ "$cstate" -eq "1" ] ; then

          printf "stdout: unknown command\n"

        fi

      ;;

    esac

  done

  return $_STATE

}

# Author of changes: trimstray (contact@nslab.at, https://github.com/trimstray)
#   - removed blank spaces/tabs
#   - correcting indentation (transparent code)
#   - replaced 'test' to '[[ ]]'
#   - changed comparison operator (-eq)
#   - protection against giving an illegal value
function menu_malware() {

  clear
  echo
  echo

  echo -e $white"     ID                    DESCRIPTION"
  echo -e $white"    ---------------------------------------------------------"
  echo -e $white"    [$okegreen"01"$white]$cyan auth-spoof "
  echo -e $white"    [$okegreen"02"$white]$cyan dns-zeustracker  "
  echo -e $white"    [$okegreen"03"$white]$cyan ftp-proftpd-backdoor "
  echo -e $white"    [$okegreen"04"$white]$cyan ftp-vsftpd-backdoor  "
  echo -e $white"    [$okegreen"05"$white]$cyan http-google-malware  "
  echo -e $white"    [$okegreen"06"$white]$cyan http-malware-host  "
  echo -e $white"    [$okegreen"07"$white]$cyan http-virustotal  "
  echo -e $white"    [$okegreen"08"$white]$cyan irc-unrealircd-backdoor  "
  echo -e $white"    [$okegreen"09"$white]$cyan smtp-strangeport "
  echo

}
